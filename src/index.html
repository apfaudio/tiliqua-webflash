<!DOCTYPE html>
<html>
<head>
    <title>Tiliqua Multiboot Flash Tool</title>
    <script src="coi-serviceworker.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/pako@2.1.0/dist/pako.min.js"></script>
    <script src="https://cdn.jsdelivr.net/pyodide/v0.24.1/full/pyodide.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="background-container"></div>
    <div class="background-overlay"></div>

    <div class="loading-indicator" id="loading-indicator">
        <div class="loading-text">
            Loading...<br>
            <span style="font-size: 16px; opacity: 0.7;">(fetching pyodide)</span>
        </div>
        <div class="spinner"></div>
    </div>

   <div class="flash-loading" id="flash-loading">
       <div class="loading-text">
           Flash operation in progress...<br>
           <span style="font-size: 16px; opacity: 0.7;">See log panel â†’</span>
       </div>
       <div class="spinner"></div>
   </div>

    <div class="main-container">
        <div class="header">
            <h1>Tiliqua Flasher</h1>
            <button class="scan-button" id="scan-button" disabled>Scan for Tiliqua</button>
            <div class="device-info" id="device-info">
                No device connected. Click "Scan for Tiliqua" to connect.
            </div>
        </div>

        <div class="circle-container">
            <div class="circle" id="main-circle">
                <!-- Tab buttons -->
                <button class="tab-button" data-slot="0">Slot 0</button>
                <button class="tab-button" data-slot="1">Slot 1</button>
                <button class="tab-button" data-slot="2">Slot 2</button>
                <button class="tab-button" data-slot="3">Slot 3</button>
                <button class="tab-button" data-slot="4">Slot 4</button>
                <button class="tab-button" data-slot="5">Slot 5</button>
                <button class="tab-button" data-slot="6">Slot 6</button>
                <button class="tab-button" data-slot="7">Slot 7</button>
                <button class="tab-button bootloader" data-slot="bootloader">Bootloader</button>

                <!-- Content for each slot -->
                <div class="circle-content" data-content="0">
                    <div class="slot-info">Slot 0 (0x100000)</div>
                    <div class="file-input-wrapper">
                        <div class="bitstream-buttons">
                            <label class="file-input-label" for="file-0">From File</label>
                            <button class="browse-button" data-slot="0">Browse</button>
                        </div>
                        <input type="file" accept=".tar.gz" id="file-0">
                        <button class="flash-button" disabled>Flash</button>
                    </div>
                    <div class="manifest-view" id="regions-0"></div>
                </div>

                <div class="circle-content" data-content="1">
                    <div class="slot-info">Slot 1 (0x200000)</div>
                    <div class="file-input-wrapper">
                        <div class="bitstream-buttons">
                            <label class="file-input-label" for="file-1">From File</label>
                            <button class="browse-button" data-slot="1">Browse</button>
                        </div>
                        <input type="file" accept=".tar.gz" id="file-1">
                        <button class="flash-button" disabled>Flash</button>
                    </div>
                    <div class="manifest-view" id="regions-1"></div>
                </div>

                <div class="circle-content" data-content="2">
                    <div class="slot-info">Slot 2 (0x300000)</div>
                    <div class="file-input-wrapper">
                        <div class="bitstream-buttons">
                            <label class="file-input-label" for="file-2">From File</label>
                            <button class="browse-button" data-slot="2">Browse</button>
                        </div>
                        <input type="file" accept=".tar.gz" id="file-2">
                        <button class="flash-button" disabled>Flash</button>
                    </div>
                    <div class="manifest-view" id="regions-2"></div>
                </div>

                <div class="circle-content" data-content="3">
                    <div class="slot-info">Slot 3 (0x400000)</div>
                    <div class="file-input-wrapper">
                        <div class="bitstream-buttons">
                            <label class="file-input-label" for="file-3">From File</label>
                            <button class="browse-button" data-slot="3">Browse</button>
                        </div>
                        <input type="file" accept=".tar.gz" id="file-3">
                        <button class="flash-button" disabled>Flash</button>
                    </div>
                    <div class="manifest-view" id="regions-3"></div>
                </div>

                <div class="circle-content" data-content="4">
                    <div class="slot-info">Slot 4 (0x500000)</div>
                    <div class="file-input-wrapper">
                        <div class="bitstream-buttons">
                            <label class="file-input-label" for="file-4">From File</label>
                            <button class="browse-button" data-slot="4">Browse</button>
                        </div>
                        <input type="file" accept=".tar.gz" id="file-4">
                        <button class="flash-button" disabled>Flash</button>
                    </div>
                    <div class="manifest-view" id="regions-4"></div>
                </div>

                <div class="circle-content" data-content="5">
                    <div class="slot-info">Slot 5 (0x600000)</div>
                    <div class="file-input-wrapper">
                        <div class="bitstream-buttons">
                            <label class="file-input-label" for="file-5">From File</label>
                            <button class="browse-button" data-slot="5">Browse</button>
                        </div>
                        <input type="file" accept=".tar.gz" id="file-5">
                        <button class="flash-button" disabled>Flash</button>
                    </div>
                    <div class="manifest-view" id="regions-5"></div>
                </div>

                <div class="circle-content" data-content="6">
                    <div class="slot-info">Slot 6 (0x700000)</div>
                    <div class="file-input-wrapper">
                        <div class="bitstream-buttons">
                            <label class="file-input-label" for="file-6">From File</label>
                            <button class="browse-button" data-slot="6">Browse</button>
                        </div>
                        <input type="file" accept=".tar.gz" id="file-6">
                        <button class="flash-button" disabled>Flash</button>
                    </div>
                    <div class="manifest-view" id="regions-6"></div>
                </div>

                <div class="circle-content" data-content="7">
                    <div class="slot-info">Slot 7 (0x800000)</div>
                    <div class="file-input-wrapper">
                        <div class="bitstream-buttons">
                            <label class="file-input-label" for="file-7">From File</label>
                            <button class="browse-button" data-slot="7">Browse</button>
                        </div>
                        <input type="file" accept=".tar.gz" id="file-7">
                        <button class="flash-button" disabled>Flash</button>
                    </div>
                    <div class="manifest-view" id="regions-7"></div>
                </div>

                <div class="circle-content" data-content="bootloader">
                    <div class="slot-info">Bootloader (0x000000)</div>
                    <div class="file-input-wrapper">
                        <div class="bitstream-buttons">
                            <label class="file-input-label" for="file-bootloader">From File</label>
                            <button class="browse-button" data-slot="bootloader">Browse</button>
                        </div>
                        <input type="file" accept=".tar.gz" id="file-bootloader">
                        <button class="flash-button" disabled>Flash</button>
                    </div>
                    <div class="manifest-view" id="regions-bootloader"></div>
                </div>

                <div class="disconnected-overlay" id="disconnected-overlay">
                    <div class="disconnected-text">
                        Disconnected
                    </div>
                </div>
            </div>
        </div>

        <div class="log-panel" id="log-panel">
            <h3>Log</h3>
            <div class="log-content" id="global-log"></div>
        </div>
    </div>

    <!-- Browse Dialog -->
    <div class="dialog-overlay" id="browse-dialog" style="display: none;">
        <div class="dialog">
            <div class="dialog-header">
                <h3>Browse Bitstreams</h3>
                <button class="dialog-close" id="browse-dialog-close">&times;</button>
            </div>
            <div class="dialog-content">
                <div class="filter-buttons">
                    <button class="filter-button active" id="filter-all">All</button>
                    <button class="filter-button cpu" id="filter-cpu">CPU</button>
                    <button class="filter-button video" id="filter-video">Video</button>
                </div>
                <div class="bitstream-list" id="bitstream-list">
                    <div class="loading">Loading bitstreams...</div>
                </div>
            </div>
            <div class="dialog-footer">
                <button class="dialog-button cancel" id="browse-cancel">Cancel</button>
                <button class="dialog-button select" id="browse-select" disabled>Select</button>
            </div>
        </div>
    </div>

    <script type="module" src="js/main.js"></script>
</body>
</html>
